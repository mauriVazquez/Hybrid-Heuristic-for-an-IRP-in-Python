{% extends "admin/base_site.html" %}
{% block title %}Proyecto Final{% endblock %}

{% block branding %}
<div id="site-name"><a href="{% url 'admin:index' %}">Transporte HAIR</a></div>
{% if user.is_anonymous %}
  {% include "admin/color_theme_toggle.html" %}
{% endif %}
{% endblock %}

{% block nav-global %}{% endblock %}
{%block content%}
    <div class="flex w-screen">
        <div class="w-8/12">
            <h1 class="w-full text-center pb-1.5">Soluciones</h1>
            <table class="w-full" id="miTabla">
                <thead>
                    <tr>
                        <th style="text-align:center"  scope="col" class="column-nombre"> C칩d. </th>
                        <th style="text-align:center"  scope="col" class="column-nombre"> Descripci칩n </th>
                        <th style="text-align:center"  scope="col" class="column-nombre"> Iteracion </th>
                        <th style="text-align:center"  scope="col" class="column-nombre"> Costo </th>
                    </tr>
                </thead>
                <tbody>
                    {% for solucion in soluciones %}
                    <tr class="fila-clickeable" data-id="{{solucion.Id}}" data-content="{{solucion}}">
                        <td style="text-align:center">{{solucion.Id}}</td>
                        <td style="text-align:center">{{solucion.Tag}}</td>
                        <td style="text-align:center">{{solucion.iteracion}}</td>
                        <td style="text-align:center">{{solucion.Costo}}</td>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="w-4/12 ">
            <h1 class=" text-center pb-1.5">GRAPH</h1>
            <div id="graph_desc" class="w-2/3 mx-auto">
            </div>
            <div id="graph_imagenes" class="w-2/3 mx-auto">
            </div>
        </div>
    </div>

    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Obtener la tabla y sus filas
        var tabla = document.getElementById("miTabla");
        var filas = tabla.getElementsByTagName("tr");

        // Agregar un evento de clic a cada fila
        for (var i = 0; i < filas.length; i++) {
            filas[i].addEventListener("click", function() {
                // Acci칩n que se ejecutar치 al hacer clic en una fila
                var dataContent = this.getAttribute("data-content");
                const csrftoken = getCookie('csrftoken');
                $.ajax({
                    url:  "{% url 'versolucion' %}",
                    type: "POST",
                    data: {solucion: dataContent}, 
                    headers: {'X-CSRFToken': csrftoken},
                    mode: 'same-origin',
                    success: function(response) {
                        $('#graph_desc').html(response.descripcion);
                        $('#graph_imagenes').html(response.imagenes);
                    },
                    error: function(error) {
                        console.log(error);
                        alert("Error al llamar a la vista Django.");
                    }
                });
            });
        }
    </script>
{%endblock%}